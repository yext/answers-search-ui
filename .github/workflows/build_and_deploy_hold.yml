name: Build and deploy with a hold state

on:
  push:
    # tags:
    #   - 'v.*'
    branches:
      - dev/build-and-deploy-hold
jobs:
  # call_build:
  #   uses: ./.github/workflows/build.yml

  # call_unit_test:
  #   uses: ./.github/workflows/unit_test.yml
  #   needs: call_build

  # call_format_branch_name:
  #   uses: ./.github/workflows/format_branch_name.yml

  call_test:
    runs-on: ubuntu-latest
    steps:
      - run: echo ${{ github.ref_name }}

  call_deploy_with_hold_state:
    needs: 
      # - call_unit_test
      # - call_format_branch_name
      - call_test
    environment:
      name: production
    runs-on: ubuntu-latest
    steps:
      - run: echo 'ran call_deploy_with_hold_state!'
    # uses: ./.github/workflows/deploy.yml
    # with:
    #   directory: dev/${{ needs.call_format_branch_name.outputs.formatted_branch }}
    # secrets:
    #   AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #   AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

concurrency:
  group: ci-build-and-deploy-hold-${{ github.ref }}-1
  cancel-in-progress: true